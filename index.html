<!DOCTYPE html>
<html>
<head>
    <title>Google Drive</title>
    <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <style>
        :root { --bg: #020617; --card: #0f172a; --accent: #3b82f6; --text: #f8fafc; --term: #4ade80; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; background-size: cover; background-position: center; background-attachment: fixed; }
        
        /* LOGIN SCREENS */
        #authLayer { position: fixed; inset: 0; background: #000; z-index: 100000; display: flex; align-items: center; justify-content: center; background-image: radial-gradient(circle at center, #111 0%, #000 100%); }
        .login-box { width: 400px; padding: 40px; background: rgba(15, 23, 42, 0.95); border: 1px solid #1e293b; border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2); }
        .hacker-title { font-family: monospace; font-size: 3rem; color: var(--accent); margin: 0; text-shadow: 0 0 15px var(--accent); }
        .update-log { text-align: left; background: #000; padding: 10px; margin-top: 20px; border: 1px solid #333; font-family: monospace; font-size: 0.8rem; color: #94a3b8; }
        
        .input-field { width: 100%; padding: 15px; margin: 15px 0; background: #000; border: 1px solid #333; color: white; border-radius: 8px; font-size: 1rem; outline: none; box-sizing: border-box; }
        .input-field:focus { border-color: var(--accent); }
        
        .btn { width: 100%; padding: 15px; background: var(--accent); color: white; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn:hover { transform: scale(1.02); }
        
        .toggle-link { margin-top: 20px; color: #555; font-size: 0.8rem; cursor: pointer; text-decoration: underline; }
        .toggle-link:hover { color: var(--accent); }

        /* MAIN UI */
        .navbar { background: rgba(15, 23, 42, 0.95); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(5px); }
        .container { padding: 30px; max-width: 1400px; margin: auto; padding-bottom: 150px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        
        .game-card { background: var(--card); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid #1e293b; position: relative; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .game-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .fav-star { position: absolute; top: 10px; right: 10px; color: rgba(255,255,255,0.1); font-size: 24px; z-index: 50; }
        .fav-star.active { color: #fbbf24; text-shadow: 0 0 10px #fbbf24; }
        .game-card b { display: block; margin-top: 10px; }

        /* ADMIN TOOLBAR */
        #adminToolbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #0f172a; padding: 20px; border-radius: 15px; border: 2px solid #3b82f6; display: none; gap: 10px; z-index: 9000; box-shadow: 0 0 30px rgba(0,0,0,0.8); flex-wrap: wrap; justify-content: center; width: 90%; max-width: 900px; }
        .adm-inp { padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; width: 140px; }
        .adm-btn { padding: 10px 15px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; color: white; }

        /* OVERLAYS */
        #gameView { position: fixed; inset: 0; background: #000; z-index: 50000; display: none; flex-direction: column; }
        iframe { flex-grow: 1; border: none; }
        #hackerScreen { position: fixed; inset: 0; background: black; color: #0f0; font-family: monospace; padding: 20px; z-index: 150000; display: none; pointer-events: none; }
        #destructScreen { position: fixed; inset: 0; background: white; z-index: 200000; display: none; align-items: center; justify-content: center; color: black; transition: 3s; opacity: 0; }
    </style>
</head>
<body>

    <div id="authLayer">
        <div id="plebLogin" class="login-box">
            <h1 class="hacker-title">MONGLE</h1>
            <p style="color:#64748b; letter-spacing: 2px;">PREMIUM ARCADE V6.4</p>
            
            <input type="text" id="plebName" class="input-field" placeholder="Create Username...">
            <button class="btn" onclick="login('pleb')">ENTER DATABASE</button>
            
            <div class="update-log">
                <b style="color:#4ade80">LATEST PATCH:</b><br>
                - Fixed Favorites Bug<br>
                - Added About:Blank Cloak<br>
                - New Admin Toolbar<br>
                - Prank System Online
            </div>

            <div class="toggle-link" onclick="swapLogin(true)">[ ADMIN SYSTEM ACCESS ]</div>
        </div>

        <div id="adminLogin" class="login-box" style="display:none; border-color: #ef4444;">
            <h1 class="hacker-title" style="color:#ef4444;">ROOT</h1>
            <p style="color:#ef4444; letter-spacing: 2px;">AUTHORIZED PERSONNEL ONLY</p>
            
            <input type="password" id="adminPass" class="input-field" placeholder="Enter Root Key..." style="border-color: #ef4444;">
            <button class="btn" style="background:#ef4444;" onclick="login('admin')">AUTHENTICATE</button>
            
            <div class="toggle-link" onclick="swapLogin(false)">[ RETURN TO GUEST LOGIN ]</div>
        </div>
    </div>

    <div id="arcadeUI" style="display:none;">
        <div class="navbar">
            <div>
                <span style="color:#4ade80; font-weight:bold;">‚óè CONNECTED</span>
                <span id="userTag" style="color:#64748b; margin-left:10px; font-family: monospace;"></span>
            </div>
            <div>
                <input type="text" id="search" onkeyup="search()" placeholder="Search..." style="padding:10px; background:#000; border:1px solid #333; color:white; border-radius:5px;">
                <button class="btn" style="width:auto; margin-left:10px; background:#334155;" onclick="openCloak()">üëÅÔ∏è CLOAK</button>
                <button class="btn" id="panicBtn" style="width:auto; background:#ef4444; margin-left:10px;">PANIC</button>
            </div>
        </div>

        <div class="container">
            <div id="favSec" style="display:none;"><h2 style="color:#fbbf24; border-left: 5px solid #fbbf24; padding-left:10px;">‚≠ê FAVORITES</h2><div id="favGrid" class="grid"></div></div>
            <div id="fnafSec" style="display:none;"><h2 style="color:#ef4444; border-left: 5px solid #ef4444; padding-left:10px;">üêª FREDDY'S COLLECTION</h2><div id="fnafGrid" class="grid"></div></div>
            <h2 style="color:var(--accent); border-left: 5px solid var(--accent); padding-left:10px;">üïπÔ∏è ALL GAMES</h2>
            <div id="mainGrid" class="grid"></div>
        </div>

        <div id="adminToolbar">
            <div style="width:100%; color:#3b82f6; font-weight:bold; margin-bottom:10px;">üîß ADMIN SETTINGS & PRANKS</div>
            
            <input id="bgInp" class="adm-inp" placeholder="Background URL">
            <button class="adm-btn" style="background:#3b82f6;" onclick="saveSet('mBg', document.getElementById('bgInp').value)">Set BG</button>
            
            <input id="iconInp" class="adm-inp" placeholder="Game Emoji (üëæ)">
            <button class="adm-btn" style="background:#3b82f6;" onclick="saveSet('mEmoji', document.getElementById('iconInp').value)">Set Icon</button>

            <input id="panicInp" class="adm-inp" placeholder="Panic URL">
            <button class="adm-btn" style="background:#3b82f6;" onclick="saveSet('mPanic', document.getElementById('panicInp').value)">Set Panic</button>

            <div style="width:1px; background:#333; margin:0 10px;"></div>

            <button class="adm-btn" style="background:#f59e0b;" onclick="triggerPrank('hacker')">üî• HACKER</button>
            <button class="adm-btn" style="background:#ef4444;" onclick="triggerPrank('destruct')">‚ò¢Ô∏è DEATH</button>
            <button class="adm-btn" style="background:#10b981;" onclick="triggerPrank('')">‚ú® CLEAR</button>
        </div>
    </div>

    <div id="gameView">
        <div style="background:#000; padding:10px; display:flex; justify-content:space-between;">
            <button class="btn" style="width:auto;" onclick="closeGame()">‚Üê EXIT GAME</button>
            <button class="btn" style="width:auto; background:red;" onclick="location.replace(localStorage.getItem('mPanic')||'https://google.com')">PANIC</button>
        </div>
        <iframe id="gameFrame"></iframe>
    </div>

    <div id="destructScreen"><h1>SYSTEM_FAILURE</h1><p>Admin has terminated the session.</p></div>
    <div id="hackerScreen"></div>

    <script>
        const REPO = { user: "bob154526-hue", name: "Mongle", pass: "1234" };

        window.onload = () => {
            if(sessionStorage.getItem('mUser')) startArcade();
            applySettings();
            checkPranks();
        };

        // --- 1. LOGIN SYSTEM ---
        function swapLogin(isAdmin) {
            document.getElementById('plebLogin').style.display = isAdmin ? 'none' : 'block';
            document.getElementById('adminLogin').style.display = isAdmin ? 'block' : 'none';
        }

        function login(type) {
            if(type === 'pleb') {
                const u = document.getElementById('plebName').value || "User";
                sessionStorage.setItem('mUser', u);
                sessionStorage.setItem('mRole', 'pleb');
                startArcade();
            } else {
                if(document.getElementById('adminPass').value === REPO.pass) {
                    sessionStorage.setItem('mUser', 'ROOT_ADMIN');
                    sessionStorage.setItem('mRole', 'admin');
                    startArcade();
                } else { alert("ACCESS DENIED"); }
            }
        }

        function startArcade() {
            document.getElementById('authLayer').style.display = 'none';
            document.getElementById('arcadeUI').style.display = 'block';
            document.getElementById('userTag').innerText = sessionStorage.getItem('mUser').toUpperCase();
            
            // Show Admin Toolbar ONLY if admin
            if(sessionStorage.getItem('mRole') === 'admin') {
                document.getElementById('adminToolbar').style.display = 'flex';
                // Pre-fill inputs
                document.getElementById('bgInp').value = localStorage.getItem('mBg') || "";
                document.getElementById('iconInp').value = localStorage.getItem('mEmoji') || "";
                document.getElementById('panicInp').value = localStorage.getItem('mPanic') || "";
            }
            loadGames();
        }

        // --- 2. SETTINGS & PRANKS ---
        function saveSet(key, val) {
            if(val) localStorage.setItem(key, val);
            else localStorage.removeItem(key);
            alert("Setting Saved! Reloading...");
            location.reload();
        }
        function applySettings() {
            const bg = localStorage.getItem('mBg');
            if(bg) document.body.style.backgroundImage = `url('${bg}')`;
            
            const panic = localStorage.getItem('mPanic') || 'https://google.com';
            document.getElementById('panicBtn').onclick = () => location.replace(panic);
        }
        function triggerPrank(p) {
            localStorage.setItem('mPrank', p);
            checkPranks();
            alert("Prank status: " + (p || "CLEARED"));
        }
        function checkPranks() {
            const p = localStorage.getItem('mPrank');
            if(p === 'destruct') {
                document.getElementById('destructScreen').style.display = 'flex';
                setTimeout(()=>document.getElementById('destructScreen').style.opacity='1', 100);
            } else if(p === 'hacker') {
                document.getElementById('hackerScreen').style.display = 'block';
                setInterval(()=>{
                    let d = document.createElement('div');
                    d.innerText = "> 0x" + Math.random().toString(16).slice(2) + " ... DECRYPTING";
                    document.getElementById('hackerScreen').appendChild(d);
                }, 100);
            } else {
                document.getElementById('destructScreen').style.display='none';
                document.getElementById('hackerScreen').style.display='none';
            }
        }
        window.addEventListener('storage', checkPranks);

        // --- 3. GAME LOADING (FIXED) ---
        async function loadGames() {
            const res = await fetch(`https://api.github.com/repos/${REPO.user}/${REPO.name}/contents/`);
            const files = await res.json();
            const favs = JSON.parse(localStorage.getItem('mFavs')) || [];
            const emoji = localStorage.getItem('mEmoji') || "üéÆ";

            // Clear existing
            document.getElementById('mainGrid').innerHTML = "";
            document.getElementById('favGrid').innerHTML = "";
            document.getElementById('fnafGrid').innerHTML = "";

            files.forEach(file => {
                if(!file.name.endsWith('.html') || file.name === 'index.html') return;
                const name = file.name.replace('.html','');
                const isFav = favs.includes(file.name);
                
                // Function to build card
                const buildCard = (forFavSection) => {
                    const d = document.createElement('div');
                    d.className = 'game-card';
                    d.innerHTML = `<span class="fav-star ${isFav && !forFavSection ? 'active' : ''}" style="${forFavSection?'display:none':''}">‚òÖ</span>
                                   <div style="font-size:45px">${emoji}</div><b>${name}</b>`;
                    
                    // Click Logic: Separate Star click from Game click
                    if(!forFavSection) {
                        d.querySelector('.fav-star').onclick = (e) => {
                            e.stopPropagation(); // STOP CLICK FROM PLAYING GAME
                            toggleFav(file.name);
                        };
                    }
                    d.onclick = (e) => {
                        if(e.target.classList.contains('fav-star')) return;
                        play(file.download_url);
                    };
                    return d;
                };

                // Add to grids
                if(isFav) {
                    document.getElementById('favSec').style.display='block';
                    document.getElementById('favGrid').appendChild(buildCard(true));
                }
                if(name.toLowerCase().includes('fnaf') || name.toLowerCase().includes('freddy')) {
                    document.getElementById('fnafSec').style.display='block';
                    document.getElementById('fnafGrid').appendChild(buildCard(false));
                } else {
                    document.getElementById('mainGrid').appendChild(buildCard(false));
                }
            });
        }

        // --- 4. UTILS ---
        async function play(url) {
            const r = await fetch(url); const h = await r.text();
            document.getElementById('gameView').style.display='flex';
            document.getElementById('gameFrame').srcdoc = h;
        }
        function closeGame() { document.getElementById('gameView').style.display='none'; document.getElementById('gameFrame').srcdoc=""; }
        
        function toggleFav(name) {
            let f = JSON.parse(localStorage.getItem('mFavs')) || [];
            if(f.includes(name)) f = f.filter(x=>x!==name);
            else f.push(name);
            localStorage.setItem('mFavs', JSON.stringify(f));
            loadGames();
        }

        function search() {
            let q = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('.game-card').forEach(c => c.style.display = c.innerText.toLowerCase().includes(q) ? 'block' : 'none');
        }

        function openCloak() {
            let win = window.open('about:blank','_blank');
            if(win) {
                win.document.write(`<body style="margin:0"><iframe src="${location.href}" style="border:0; width:100%; height:100vh;"></iframe></body>`);
                location.href = localStorage.getItem('mPanic') || "https://google.com";
            } else { alert("Allow Popups!"); }
        }
    </script>
</body>
</html>
