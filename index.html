<!DOCTYPE html>
<html>
<head>
    <title>Google Docs</title>
    <style>
        :root { --bg: #020617; --card: #0f172a; --accent: #3b82f6; --text: #f8fafc; }
        body { 
            background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; 
            background-size: cover; background-position: center; background-attachment: fixed;
        }
        /* Navigation */
        .navbar { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; position: sticky; top: 0; z-index: 1000; }
        .container { padding: 30px; max-width: 1400px; margin: 0 auto; }
        
        /* Grids */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .game-card { background: var(--card); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; border: 1px solid #1e293b; transition: 0.3s; position: relative; }
        .game-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        /* Launch Modal */
        #launchModal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 20000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .launch-box { background: #0f172a; padding: 30px; border-radius: 20px; border: 2px solid var(--accent); text-align: center; max-width: 400px; }
        
        /* Game View */
        #gameView { position: fixed; inset: 0; background: #000; z-index: 30000; display: none; flex-direction: column; }
        #gameFrame { flex-grow: 1; border: none; background: #fff; }
        
        /* UI Elements */
        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; color: white; background: var(--accent); margin: 5px; transition: 0.2s; }
        .btn:hover { opacity: 0.8; }
        .btn-panic { background: #ef4444; }
        .section-header { color: var(--accent); border-left: 4px solid var(--accent); padding-left: 12px; margin: 40px 0 20px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Login */
        .auth-screen { position: fixed; inset: 0; background: #000; z-index: 50000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #adminLink { display: none; position: fixed; bottom: 20px; right: 20px; background: #ef4444; padding: 10px 15px; border-radius: 10px; color: white; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <div id="authScreen" class="auth-screen">
        <h1 style="color:var(--accent); font-size: 4rem; margin-bottom: 10px;">MONGLE</h1>
        <div id="userPart">
            <input type="text" id="userInput" placeholder="Username..." style="padding:15px; width:280px; background:#111; color:white; border:1px solid #333; border-radius:10px;">
            <br><button class="btn" style="width:310px; margin-top:15px;" onclick="handleUser()">Continue</button>
        </div>
        <div id="passPart" style="display:none;">
            <p>Enter Password for Mongle:</p>
            <input type="password" id="passInput" placeholder="Password..." style="padding:15px; width:280px; background:#111; color:white; border:1px solid #333; border-radius:10px;">
            <br><button class="btn" style="width:310px; margin-top:15px;" onclick="handlePass()">Verify Owner</button>
        </div>
    </div>

    <div class="navbar">
        <div id="clock" style="color:#4ade80; font-family: monospace; font-weight: bold; font-size: 1.2rem;">00:00:00</div>
        <div style="display:flex; align-items:center; gap:10px;">
            <input type="text" id="search" placeholder="Search games..." onkeyup="doSearch()" style="padding:10px; background:#000; color:white; border:1px solid #333; border-radius:10px;">
            <a href="wiki.html" class="btn" style="background:#334155;">Settings</a>
            <button class="btn btn-panic" onclick="location.replace('https://classroom.google.com')">Panic</button>
        </div>
    </div>

    <div id="arcade" class="container">
        <div id="fnafSection" style="display:none;">
            <h2 class="section-header">üêª FNAF COLLECTION</h2>
            <div id="fnafGrid" class="grid"></div>
        </div>
        
        <h2 class="section-header">üïπÔ∏è ALL GAMES</h2>
        <div id="mainGrid" class="grid"></div>
    </div>

    <div id="launchModal">
        <div class="launch-box">
            <h2 id="launchTitle" style="color:var(--accent); margin-top:0;">Game Title</h2>
            <p>Select how you want to play:</p>
            <button class="btn" style="width:90%" onclick="playStandard()">Play in Browser</button>
            <button class="btn" style="width:90%; background:#6366f1;" onclick="playStealth()">Play in About:Blank (Stealth)</button>
            <br><button class="btn" style="background:none; color:#666;" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <div id="gameView">
        <div style="background:#000; padding:10px; display:flex; justify-content:space-between;">
            <button class="btn" onclick="exitGame()" style="background:#334155;">‚Üê Exit Game</button>
            <button class="btn btn-panic" onclick="location.replace('https://classroom.google.com')">Panic</button>
        </div>
        <iframe id="gameFrame"></iframe>
    </div>

    <a href="wiki.html?mode=admin" id="adminLink">‚öôÔ∏è ADMIN PANEL</a>

    <script>
        const REPO_USER = "bob154526-hue";
        const REPO_NAME = "Mongle";
        let activeGameUrl = "";
        let activeGameName = "";

        // --- THEME ENGINE ---
        if(localStorage.getItem('mBG')) {
            const bg = localStorage.getItem('mBG');
            document.body.style.backgroundImage = bg.includes('http') ? `url(${bg})` : 'none';
            if(!bg.includes('http')) document.body.style.backgroundColor = bg;
        }

        // --- AUTH ---
        if(sessionStorage.getItem('mAuth')) document.getElementById('authScreen').style.display = 'none';
        
        function handleUser() {
            let n = document.getElementById('userInput').value.trim().toLowerCase();
            if(n === 'mongle') {
                document.getElementById('userPart').style.display = 'none';
                document.getElementById('passPart').style.display = 'block';
            } else if(n) {
                sessionStorage.setItem('mAuth', n); location.reload();
            }
        }
        function handlePass() {
            if(document.getElementById('passInput').value === "1234") {
                sessionStorage.setItem('mAuth', 'mongle'); location.reload();
            } else { alert("Access Denied"); }
        }

        // --- SEARCH & ADMIN ---
        function doSearch() {
            let q = document.getElementById('search').value.toLowerCase();
            document.getElementById('adminLink').style.display = (q === 'admin') ? 'block' : 'none';
            document.querySelectorAll('.game-card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(q) ? 'block' : 'none';
            });
        }

        // --- GAME LOADING ---
        async function load() {
            const res = await fetch(`https://api.github.com/repos/${REPO_USER}/${REPO_NAME}/contents/`);
            const files = await res.json();
            const main = document.getElementById('mainGrid');
            const fnaf = document.getElementById('fnafGrid');
            
            files.forEach(file => {
                if(!file.name.endsWith('.html') || file.name === 'index.html' || file.name === 'wiki.html') return;
                
                const name = file.name.replace('.html', '');
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `<div style="font-size:40px">${localStorage.getItem('mEmoji') || 'üéÆ'}</div><b>${name}</b>`;
                card.onclick = () => openLaunchModal(file.download_url, name);
                
                if(name.toLowerCase().includes('fnaf') || name.toLowerCase().includes('freddy')) {
                    document.getElementById('fnafSection').style.display = 'block';
                    fnaf.appendChild(card);
                } else {
                    main.appendChild(card);
                }
            });
        }

        function openLaunchModal(url, name) {
            activeGameUrl = url;
            activeGameName = name;
            document.getElementById('launchTitle').innerText = name;
            document.getElementById('launchModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('launchModal').style.display = 'none'; }

        // FIX FOR THE "REFUSED TO CONNECT" BUG
        async function playStandard() {
            closeModal();
            document.getElementById('gameView').style.display = 'flex';
            const frame = document.getElementById('gameFrame');
            
            // Fetch content to bypass GitHub Frame Deny
            const response = await fetch(activeGameUrl);
            const html = await response.text();
            frame.srcdoc = html; 
        }

        function playStealth() {
            const win = window.open('about:blank', '_blank');
            if(!win) { alert("Please allow popups!"); return; }
            
            fetch(activeGameUrl).then(res => res.text()).then(html => {
                win.document.write(`
                    <title>${activeGameName}</title>
                    <body style="margin:0;overflow:hidden;">
                        <iframe srcdoc="${html.replace(/"/g, '&quot;')}" style="width:100vw;height:100vh;border:none;"></iframe>
                    </body>
                `);
            });
            window.location.replace('https://google.com');
        }

        function exitGame() {
            document.getElementById('gameView').style.display = 'none';
            document.getElementById('gameFrame').srcdoc = "";
        }

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
        load();
    </script>
</body>
</html>
